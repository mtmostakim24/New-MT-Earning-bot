<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Earning545 | Admin Panel</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }
    
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --secondary: #4cc9f0;
      --success: #4ade80;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark: #1e293b;
      --light: #f8fafc;
      --card-bg: #ffffff;
      --body-bg: #f1f5f9;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      --transition: all 0.3s ease;
    }
    
    body {
      background-color: var(--body-bg);
      color: var(--dark);
      min-height: 100vh;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    }
    
    /* Admin Header */
    .admin-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .admin-title {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      font-size: 1.2rem;
      font-weight: 700;
    }
    
    .admin-title i {
      font-size: 1.5rem;
    }
    
    .admin-logout {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }
    
    .admin-logout:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* Admin Container */
    .admin-container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: var(--shadow);
      text-align: center;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: #666;
      font-weight: 500;
    }
    
    /* Admin Cards */
    .admin-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }
    
    .admin-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .admin-card-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--dark);
    }
    
    .admin-card-title i {
      color: var(--primary);
    }
    
    /* Tables */
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    
    .admin-table th,
    .admin-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .admin-table th {
      background: var(--primary);
      color: white;
      font-weight: 600;
    }
    
    .admin-table tr:last-child td {
      border-bottom: none;
    }
    
    .admin-table tr:hover {
      background: #f8fafc;
    }
    
    /* Status Badges */
    .status-pending {
      background: var(--warning);
      color: white;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-completed {
      background: var(--success);
      color: white;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-rejected {
      background: var(--danger);
      color: white;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    /* Buttons */
    .btn {
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      font-size: 0.85rem;
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .btn-success:hover {
      background: #22c55e;
    }
    
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    
    .btn-danger:hover {
      background: #dc2626;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
    }
    
    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 5px;
    }
    
    /* Login Form */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .login-card {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 400px;
    }
    
    .login-title {
      text-align: center;
      margin-bottom: 30px;
      color: var(--primary);
      font-size: 1.5rem;
      font-weight: 700;
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
    }
    
    .input-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
      background: #f8fafc;
      transition: var(--transition);
    }
    
    .input-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
    
    .login-btn {
      width: 100%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
    }
    
    /* Search and Filters */
    .admin-filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .search-box {
      flex: 1;
      min-width: 250px;
    }
    
    .search-box input {
      width: 100%;
      padding: 10px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.9rem;
    }
    
    .filter-select {
      padding: 10px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: white;
      font-size: 0.9rem;
      min-width: 150px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .admin-container {
        padding: 15px;
      }
      
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
      
      .admin-table {
        font-size: 0.8rem;
      }
      
      .admin-table th,
      .admin-table td {
        padding: 8px 10px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .btn {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <!-- Admin Login -->
  <div id="admin-login" class="login-container">
    <div class="login-card">
      <h2 class="login-title">
        <i class="fas fa-lock"></i> Admin Login
      </h2>
      <div class="input-group">
        <label for="admin-username">Username</label>
        <input type="text" id="admin-username" placeholder="Enter admin username">
      </div>
      <div class="input-group">
        <label for="admin-password">Password</label>
        <input type="password" id="admin-password" placeholder="Enter admin password">
      </div>
      <button class="login-btn" onclick="adminLogin()">
        <i class="fas fa-sign-in-alt"></i> Login
      </button>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" style="display: none;">
    <!-- Header -->
    <div class="admin-header">
      <div class="admin-title">
        <i class="fas fa-crown"></i>
        <span>Daily Earning545 - Admin Panel</span>
      </div>
      <button class="admin-logout" onclick="adminLogout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>

    <!-- Main Content -->
    <div class="admin-container">
      <!-- Stats Overview -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="total-users">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="pending-withdrawals">0</div>
          <div class="stat-label">Pending Withdrawals</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="total-withdrawn">$0</div>
          <div class="stat-label">Total Withdrawn</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="today-earnings">$0</div>
          <div class="stat-label">Today's Earnings</div>
        </div>
      </div>

      <!-- Pending Withdrawals -->
      <div class="admin-card">
        <div class="admin-card-header">
          <div class="admin-card-title">
            <i class="fas fa-clock"></i>
            <span>Pending Withdrawals</span>
          </div>
          <div class="admin-filters">
            <div class="search-box">
              <input type="text" id="withdrawal-search" placeholder="Search by user ID or method...">
            </div>
            <select class="filter-select" id="withdrawal-method-filter">
              <option value="all">All Methods</option>
              <option value="Bkash">Bkash</option>
              <option value="Nagad">Nagad</option>
              <option value="Payeer">Payeer</option>
              <option value="USDT">USDT</option>
              <option value="Skrill">Skrill</option>
              <option value="Neteller">Neteller</option>
              <option value="Perfect Money">Perfect Money</option>
            </select>
          </div>
        </div>
        
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>User ID</th>
                <th>Amount</th>
                <th>Method</th>
                <th>Address</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="pending-withdrawals-body">
              <!-- Pending withdrawals will be populated here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Completed Withdrawals -->
      <div class="admin-card">
        <div class="admin-card-header">
          <div class="admin-card-title">
            <i class="fas fa-check-circle"></i>
            <span>Completed Withdrawals</span>
          </div>
        </div>
        
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>User ID</th>
                <th>Amount</th>
                <th>Method</th>
                <th>Address</th>
                <th>Date</th>
                <th>Completed Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="completed-withdrawals-body">
              <!-- Completed withdrawals will be populated here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- All Users -->
      <div class="admin-card">
        <div class="admin-card-header">
          <div class="admin-card-title">
            <i class="fas fa-users"></i>
            <span>All Users</span>
          </div>
          <div class="admin-filters">
            <div class="search-box">
              <input type="text" id="user-search" placeholder="Search by user ID...">
            </div>
          </div>
        </div>
        
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>User ID</th>
                <th>Username</th>
                <th>Balance</th>
                <th>Total Earned</th>
                <th>Referrals</th>
                <th>Join Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="all-users-body">
              <!-- All users will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Admin credentials (In real app, this should be on server side)
    const ADMIN_CREDENTIALS = {
      username: "admin",
      password: "admin123"
    };

    // Check if admin is logged in
    function checkAdminLogin() {
      return localStorage.getItem('adminLoggedIn') === 'true';
    }

    // Admin login function
    function adminLogin() {
      const username = document.getElementById('admin-username').value;
      const password = document.getElementById('admin-password').value;

      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        localStorage.setItem('adminLoggedIn', 'true');
        showAdminPanel();
        loadAdminData();
      } else {
        alert('Invalid admin credentials!');
      }
    }

    // Admin logout function
    function adminLogout() {
      localStorage.removeItem('adminLoggedIn');
      showLoginForm();
    }

    // Show admin panel
    function showAdminPanel() {
      document.getElementById('admin-login').style.display = 'none';
      document.getElementById('admin-panel').style.display = 'block';
    }

    // Show login form
    function showLoginForm() {
      document.getElementById('admin-login').style.display = 'flex';
      document.getElementById('admin-panel').style.display = 'none';
    }

    // Load all admin data
    function loadAdminData() {
      loadWithdrawalData();
      loadUsersData();
      updateStats();
    }

    // Load withdrawal data
    function loadWithdrawalData() {
      // Get all users data from localStorage
      const allUsers = getAllUsers();
      const pendingWithdrawals = [];
      const completedWithdrawals = [];

      allUsers.forEach(user => {
        if (user.withdrawalHistory) {
          user.withdrawalHistory.forEach(withdrawal => {
            const withdrawalData = {
              userId: user.userId,
              username: user.username,
              amount: withdrawal.amount,
              method: withdrawal.method,
              address: withdrawal.address,
              date: withdrawal.date,
              status: withdrawal.status,
              completedDate: withdrawal.completedDate
            };

            if (withdrawal.status === 'pending') {
              pendingWithdrawals.push(withdrawalData);
            } else if (withdrawal.status === 'completed') {
              completedWithdrawals.push(withdrawalData);
            }
          });
        }
      });

      // Sort by date (newest first)
      pendingWithdrawals.sort((a, b) => new Date(b.date) - new Date(a.date));
      completedWithdrawals.sort((a, b) => new Date(b.completedDate || b.date) - new Date(a.completedDate || a.date));

      // Update pending withdrawals table
      const pendingBody = document.getElementById('pending-withdrawals-body');
      pendingBody.innerHTML = '';

      if (pendingWithdrawals.length === 0) {
        pendingBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #666;">No pending withdrawals</td></tr>';
      } else {
        pendingWithdrawals.forEach(withdrawal => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${withdrawal.userId}</td>
            <td>$${withdrawal.amount}</td>
            <td>${withdrawal.method}</td>
            <td>${withdrawal.address}</td>
            <td>${withdrawal.date}</td>
            <td><span class="status-pending">Pending</span></td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-success" onclick="completeWithdrawal('${withdrawal.userId}', ${withdrawal.amount}, '${withdrawal.method}', '${withdrawal.date}')">
                  <i class="fas fa-check"></i> Complete
                </button>
                <button class="btn btn-danger" onclick="rejectWithdrawal('${withdrawal.userId}', ${withdrawal.amount}, '${withdrawal.method}', '${withdrawal.date}')">
                  <i class="fas fa-times"></i> Reject
                </button>
              </div>
            </td>
          `;
          pendingBody.appendChild(row);
        });
      }

      // Update completed withdrawals table
      const completedBody = document.getElementById('completed-withdrawals-body');
      completedBody.innerHTML = '';

      if (completedWithdrawals.length === 0) {
        completedBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #666;">No completed withdrawals</td></tr>';
      } else {
        completedWithdrawals.forEach(withdrawal => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${withdrawal.userId}</td>
            <td>$${withdrawal.amount}</td>
            <td>${withdrawal.method}</td>
            <td>${withdrawal.address}</td>
            <td>${withdrawal.date}</td>
            <td>${withdrawal.completedDate || withdrawal.date}</td>
            <td><span class="status-completed">Completed</span></td>
          `;
          completedBody.appendChild(row);
        });
      }
    }

    // Load users data
    function loadUsersData() {
      const allUsers = getAllUsers();
      const usersBody = document.getElementById('all-users-body');
      usersBody.innerHTML = '';

      if (allUsers.length === 0) {
        usersBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #666;">No users found</td></tr>';
      } else {
        allUsers.forEach(user => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${user.userId}</td>
            <td>${user.username}</td>
            <td>$${user.lifetimeEarning?.toFixed(3) || '0.000'}</td>
            <td>$${user.lifetimeEarning?.toFixed(3) || '0.000'}</td>
            <td>${user.referrals || 0}</td>
            <td>${user.joinDate || 'N/A'}</td>
            <td>
              <button class="btn btn-primary" onclick="viewUserDetails('${user.userId}')">
                <i class="fas fa-eye"></i> View
              </button>
            </td>
          `;
          usersBody.appendChild(row);
        });
      }
    }

    // Update statistics
    function updateStats() {
      const allUsers = getAllUsers();
      const pendingWithdrawals = allUsers.reduce((total, user) => {
        if (user.withdrawalHistory) {
          return total + user.withdrawalHistory.filter(w => w.status === 'pending').length;
        }
        return total;
      }, 0);

      const totalWithdrawn = allUsers.reduce((total, user) => {
        if (user.withdrawalHistory) {
          const userWithdrawn = user.withdrawalHistory
            .filter(w => w.status === 'completed')
            .reduce((sum, w) => sum + w.amount, 0);
          return total + userWithdrawn;
        }
        return total;
      }, 0);

      document.getElementById('total-users').textContent = allUsers.length;
      document.getElementById('pending-withdrawals').textContent = pendingWithdrawals;
      document.getElementById('total-withdrawn').textContent = `$${totalWithdrawn.toFixed(2)}`;
      
      // Calculate today's earnings (simplified)
      const todayEarnings = allUsers.reduce((total, user) => {
        return total + (user.todaysEarning || 0);
      }, 0);
      document.getElementById('today-earnings').textContent = `$${todayEarnings.toFixed(2)}`;
    }

    // Get all users from localStorage
    function getAllUsers() {
      const users = [];
      
      // Get all keys from localStorage
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('MTEarningData')) {
          try {
            const userData = JSON.parse(localStorage.getItem(key));
            if (userData && userData.userId) {
              users.push(userData);
            }
          } catch (e) {
            console.error('Error parsing user data:', e);
          }
        }
      }
      
      return users;
    }

    // Complete withdrawal
    function completeWithdrawal(userId, amount, method, date) {
      if (confirm(`Complete withdrawal of $${amount} for user ${userId}?`)) {
        // Find user data
        const userKey = `MTEarningData_${userId}`;
        let userData = JSON.parse(localStorage.getItem(userKey));
        
        if (!userData) {
          // Try without prefix
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const data = JSON.parse(localStorage.getItem(key));
            if (data && data.userId === userId) {
              userData = data;
              break;
            }
          }
        }

        if (userData && userData.withdrawalHistory) {
          // Update withdrawal status
          userData.withdrawalHistory.forEach(withdrawal => {
            if (withdrawal.amount === amount && 
                withdrawal.method === method && 
                withdrawal.date === date && 
                withdrawal.status === 'pending') {
              withdrawal.status = 'completed';
              withdrawal.completedDate = new Date().toLocaleDateString();
            }
          });

          // Update user data in localStorage
          const userKey = Object.keys(localStorage).find(key => {
            try {
              const data = JSON.parse(localStorage.getItem(key));
              return data && data.userId === userId;
            } catch {
              return false;
            }
          });

          if (userKey) {
            localStorage.setItem(userKey, JSON.stringify(userData));
          }

          alert('Withdrawal completed successfully!');
          loadAdminData();
        } else {
          alert('User data not found!');
        }
      }
    }

    // Reject withdrawal
    function rejectWithdrawal(userId, amount, method, date) {
      if (confirm(`Reject withdrawal of $${amount} for user ${userId}?`)) {
        // Find user data
        const userKey = `MTEarningData_${userId}`;
        let userData = JSON.parse(localStorage.getItem(userKey));
        
        if (!userData) {
          // Try without prefix
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const data = JSON.parse(localStorage.getItem(key));
            if (data && data.userId === userId) {
              userData = data;
              break;
            }
          }
        }

        if (userData && userData.withdrawalHistory) {
          // Remove withdrawal from history or mark as rejected
          userData.withdrawalHistory = userData.withdrawalHistory.filter(withdrawal => 
            !(withdrawal.amount === amount && 
              withdrawal.method === method && 
              withdrawal.date === date && 
              withdrawal.status === 'pending')
          );

          // Return amount to user's balance
          userData.lifetimeEarning += amount;

          // Update user data in localStorage
          const userKey = Object.keys(localStorage).find(key => {
            try {
              const data = JSON.parse(localStorage.getItem(key));
              return data && data.userId === userId;
            } catch {
              return false;
            }
          });

          if (userKey) {
            localStorage.setItem(userKey, JSON.stringify(userData));
          }

          alert('Withdrawal rejected and amount returned to user balance!');
          loadAdminData();
        } else {
          alert('User data not found!');
        }
      }
    }

    // View user details
    function viewUserDetails(userId) {
      alert(`User ID: ${userId}\nView detailed user information here.`);
      // In a real app, you would show a modal with detailed user information
    }

    // Initialize admin panel
    function initAdminPanel() {
      if (checkAdminLogin()) {
        showAdminPanel();
        loadAdminData();
      } else {
        showLoginForm();
      }

      // Add search functionality
      document.getElementById('withdrawal-search').addEventListener('input', filterWithdrawals);
      document.getElementById('user-search').addEventListener('input', filterUsers);
      document.getElementById('withdrawal-method-filter').addEventListener('change', filterWithdrawals);
    }

    // Filter withdrawals
    function filterWithdrawals() {
      const searchTerm = document.getElementById('withdrawal-search').value.toLowerCase();
      const methodFilter = document.getElementById('withdrawal-method-filter').value;
      
      // This would filter the displayed withdrawals in a real implementation
      console.log('Filtering withdrawals:', searchTerm, methodFilter);
    }

    // Filter users
    function filterUsers() {
      const searchTerm = document.getElementById('user-search').value.toLowerCase();
      // This would filter the displayed users in a real implementation
      console.log('Filtering users:', searchTerm);
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', initAdminPanel);
  </script>
</body>
</html>
